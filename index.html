<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML File Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }

        #app {
            width: 80%;
            max-width: 800px;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        #authorize-button, #signout-button {
            display: none;
            padding: 10px 20px;
            margin-bottom: 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #authorize-button:hover, #signout-button:hover {
            background-color: #0056b3;
        }

        #search {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #file-list {
            list-style: none;
            padding: 0;
            margin: 0;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #file-list li {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
        }

        #file-list li:hover {
            background-color: #f0f0f0;
        }

        #file-content {
            width: 100%;
            height: 200px;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: none;
        }

        #file-input {
            display: none;
        }

        #add-file-button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #add-file-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Gerenciador de Arquivos HTML</h1>
        <button id="authorize-button">Authorize</button>
        <button id="signout-button">Sign Out</button>
        <input type="text" id="search" placeholder="Pesquisar arquivos...">
        <ul id="file-list"></ul>
        <textarea id="file-content" readonly></textarea>
        <input type="file" id="file-input">
        <button id="add-file-button">Adicionar Arquivo</button>
    </div>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        let GoogleAuth;
        const SCOPE = 'https://www.googleapis.com/auth/drive.file';

        document.addEventListener('DOMContentLoaded', () => {
            const authorizeButton = document.getElementById('authorize-button');
            const signoutButton = document.getElementById('signout-button');
            const fileList = document.getElementById('file-list');
            const fileContent = document.getElementById('file-content');
            const searchInput = document.getElementById('search');
            const fileInput = document.getElementById('file-input');
            const addFileButton = document.getElementById('add-file-button');

            gapi.load('client:auth2', () => {
                gapi.client.init({
                    'clientId': 'YOUR_CLIENT_ID',
                    'scope': SCOPE
                }).then(() => {
                    GoogleAuth = gapi.auth2.getAuthInstance();

                    GoogleAuth.isSignedIn.listen(updateSigninStatus);

                    authorizeButton.onclick = handleAuthClick;
                    signoutButton.onclick = handleSignoutClick;

                    updateSigninStatus(GoogleAuth.isSignedIn.get());
                });
            });

            function updateSigninStatus(isSignedIn) {
                if (isSignedIn) {
                    authorizeButton.style.display = 'none';
                    signoutButton.style.display = 'block';
                    listFiles();
                } else {
                    authorizeButton.style.display = 'block';
                    signoutButton.style.display = 'none';
                }
            }

            function handleAuthClick() {
                GoogleAuth.signIn();
            }

            function handleSignoutClick() {
                GoogleAuth.signOut();
            }

            function listFiles() {
                gapi.client.drive.files.list({
                    'pageSize': 10,
                    'fields': "nextPageToken, files(id, name)",
                    'q': "mimeType='text/html'"
                }).then((response) => {
                    const files = response.result.files;
                    if (files && files.length > 0) {
                        fileList.innerHTML = '';
                        files.forEach(file => {
                            const li = document.createElement('li');
                            li.textContent = file.name;
                            li.addEventListener('click', () => {
                                gapi.client.drive.files.get({
                                    fileId: file.id,
                                    alt: 'media'
                                }).then((response) => {
                                    fileContent.value = response.body;
                                });
                            });
                            fileList.appendChild(li);
                        });
                    } else {
                        fileList.innerHTML = '<li>No files found.</li>';
                    }
                });
            }

            searchInput.addEventListener('input', (e) => {
                const filter = e.target.value.toLowerCase();
                const items = fileList.getElementsByTagName('li');
                Array.from(items).forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(filter)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            addFileButton.addEventListener('click', () => {
                fileInput.click();
            });

            fileInput.addEventListener('change', () => {
                const file = fileInput.files[0];
                if (file) {
                    const metadata = {
                        'name': file.name,
                        'mimeType': 'text/html'
                    };
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', file);

                    fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                        method: 'POST',
                        headers: new Headers({ 'Authorization': 'Bearer ' + GoogleAuth.currentUser.get().getAuthResponse().access_token }),
                        body: form
                    }).then(() => {
                        listFiles();
                    });
                }
            });
        });
    </script>
</body>
</html>
